<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Intercom Dashboard</title>
</meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

body {
    margin: 0;
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: linear-gradient(135deg, #23243a 0%, #2c5364 100%);
    color: #f7f7fa;
    min-height: 100vh;
}
.div1 {
    width: 100%;
    text-align: center;
    padding: 36px 0 18px 0;
    font-size: 2.1em;
    font-weight: 700;
    letter-spacing: 1px;
    color: #fff;
    opacity: 0.93;
    text-shadow: 0 2px 12px #0006;
}
.dashboard-row {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: flex-start;
    gap: 32px;
    flex-wrap: wrap;
    width: 100%;
    margin: 0 auto;
    max-width: 1100px;
}
.card {
    background: rgba(255,255,255,0.07);
    border-radius: 18px;
    padding: 28px 26px 22px 26px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    min-width: 290px;
    max-width: 340px;
    flex: 1 1 320px;
    margin-bottom: 18px;
    transition: box-shadow 0.2s;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
.card h2 {
    text-align: left;
    margin: 0 0 18px 0;
    font-size: 1.3em;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #e0e6f7;
}
.percent {
    font-size: 2.1em;
    text-align: left;
    font-weight: bold;
    margin-bottom: 8px;
    color: #7ed6fa;
}
input[type=range] {
    width: 100%;
    margin: 18px 0 10px 0;
    accent-color: #3498db;
    height: 6px;
    border-radius: 6px;
    background: #222;
    box-shadow: 0 2px 8px rgba(0,0,0,0.10);
}
button {
    width: 100%;
    padding: 13px;
    border-radius: 13px;
    border: none;
    font-size: 1.08em;
    cursor: pointer;
    background: #3498db;
    color: #fff;
    margin-top: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.10);
}
button:hover {
    background: #217dbb;
    color: #eaf6ff;
    box-shadow: 0 4px 16px rgba(0,0,0,0.18);
}
.info {
    font-size: 1em;
    line-height: 1.7em;
    color: #e0e6f7;
    background: rgba(0,0,0,0.07);
    border-radius: 8px;
    padding: 10px 12px;
    margin-top: 6px;
}
</style>
</style>
</head>
<body>
    <div class="parent">
        <div class="div1">ðŸŽ™ Intercom project by Anish, Bowen, Runar</div>
        <div class="dashboard-row">
            <div class="card">
                <h2>Volume</h2>
                <div class="percent"><span id="volValue">{{vol}}</span>%</div>
                <input type="range" min="0" max="100" value="{{vol}}" oninput="setVolume(this.value)">
                <button id="muteBtn" onclick="toggleMute()">{{ 'Unmute' if not mute else 'Mute' }}</button>
            </div>
            <div class="card">
                <h2>Device Info</h2>
                <div class="info">
                    <strong>Hostname:</strong> <span id="hostname">Loading...</span><br>
                    <strong>IP:</strong> <span id="ip">Loading...</span><br>
                    <strong>UDP Port:</strong> <span id="udpPort">Loading...</span><br>
                    <strong>HTTP Port:</strong> <span id="httpPort">Loading...</span><br>
                    <strong>Uptime:</strong> <span id="uptime">Loading...</span>
                </div>
            </div>
            <div class="card">
                <h2>Status</h2>
                <div class="info">
                    <strong>Connected:</strong> <span id="connected">...</span><br>
                    <strong>Last Audio Time:</strong> <span id="lastAudio">...</span><br>
                    <strong>Last User IP:</strong> <span id="lastUserIp">...</span><br>
                    <strong>Audio Level:</strong>
                    <div style="background:#222; border-radius:6px; height:16px; width:100%; margin:6px 0;">
                        <div id="audioLevelBar" style="background:#7ed6fa; height:100%; width:0%; border-radius:6px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
function updateStatus(){
    fetch('/status')
        .then(r => r.json())
        .then(s => {
            document.getElementById('connected').innerText = s.connected ? 'Yes' : 'No';
            document.getElementById('lastAudio').innerText = s.last_audio_time;
            document.getElementById('lastUserIp').innerText = s.last_user_ip;
            // Audio level bar (0-1)
            let pct = Math.round(Math.max(0, Math.min(1, s.audio_level)) * 100);
            document.getElementById('audioLevelBar').style.width = pct + '%';
        })
        .catch(e => console.log('Failed to fetch status', e));
}
setInterval(updateStatus, 500);
updateStatus();


function setVolume(val){
    fetch('/set_volume?vol=' + val);
    document.getElementById('volValue').innerText = val;
}

function toggleMute(){
    fetch('/toggle_mute')
        .then(r => r.json())
        .then(d => {
            document.getElementById('muteBtn').innerText = d.mute ? 'Unmute' : 'Mute';
        });
}

function updateInfo(){
    fetch('/info')
        .then(r => r.json())
        .then(i => {
            document.getElementById('hostname').innerText = i.hostname;
            document.getElementById('ip').innerText = i.ip;
            document.getElementById('udpPort').innerText = i.udp_port;
            document.getElementById('httpPort').innerText = i.http_port;
            document.getElementById('uptime').innerText = i.uptime;
        }).catch(e => console.log("Failed to fetch info", e));
}
setInterval(updateInfo, 5000);
updateInfo();
</script>
</body>
</html>